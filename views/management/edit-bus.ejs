<div class="container animate__animated animate__fadeIn">
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm border-warning">
        <div class="card-body d-md-flex justify-content-between align-items-center">
          <div>
            <h2 class="card-title">
              <i class="fas fa-edit text-warning me-2"></i> Edit Bus
            </h2>
            <p class="text-muted mb-md-0">Update bus information</p>
          </div>
          <div class="mt-3 mt-md-0">
            <a href="/management/buses" class="btn btn-outline-secondary">
              <i class="fas fa-arrow-left me-1"></i> Back to List
            </a>
            <a href="/management/buses/view/<%= bus._id %>" class="btn btn-outline-primary ms-2">
              <i class="fas fa-eye me-1"></i> View Details
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-light">
          <h5 class="mb-0">
            <i class="fas fa-bus-alt text-warning me-2"></i> Bus Information
          </h5>
        </div>
        <div class="card-body">
          <% if(typeof error_msg !== 'undefined' && error_msg.length > 0) { %>
            <div class="alert alert-danger animate__animated animate__shakeX">
              <%= error_msg %>
            </div>
          <% } %>
          <% if(typeof success_msg !== 'undefined' && success_msg.length > 0) { %>
            <div class="alert alert-success animate__animated animate__bounceIn">
              <%= success_msg %>
            </div>
          <% } %>
          
          <form action="/management/buses/update/<%= bus._id %>?_method=PUT" method="POST">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="busName" class="form-label">Bus Name <span class="text-danger">*</span></label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-tag"></i></span>
                  <input type="text" class="form-control" id="busName" name="busName" value="<%= bus.busName || 'College Bus' %>" required>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label for="busId" class="form-label">Bus ID <span class="text-danger">*</span></label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-id-card"></i></span>
                  <input type="text" class="form-control" id="busId" name="busId" value="<%= bus.busId %>" readonly>
                </div>
                <div class="form-text text-warning">Bus ID cannot be changed after creation.</div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="busNumber" class="form-label">Bus Number <span class="text-danger">*</span></label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-hashtag"></i></span>
                  <input type="text" class="form-control" id="busNumber" name="busNumber" value="<%= bus.busNumber || '' %>" required>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label for="plateNumber" class="form-label">Plate Number <span class="text-danger">*</span></label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-car"></i></span>
                  <input type="text" class="form-control" id="plateNumber" name="plateNumber" value="<%= bus.plateNumber || '' %>" required>
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="driverName" class="form-label">Driver Name <span class="text-danger">*</span></label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-user"></i></span>
                  <input type="text" class="form-control" id="driverName" name="driverName" value="<%= bus.driverName %>" required>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label for="route" class="form-label">Route <span class="text-danger">*</span></label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-route"></i></span>
                  <input type="text" class="form-control" id="route" name="route" value="<%= bus.route %>" required>
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="capacity" class="form-label">Capacity <span class="text-danger">*</span></label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-users"></i></span>
                  <input type="number" class="form-control" id="capacity" name="capacity" min="1" max="100" value="<%= bus.capacity %>" required>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label for="currentLocation" class="form-label">Current Location</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                  <input type="text" class="form-control" id="currentLocation" name="currentLocation" value="<%= bus.currentLocation || 'College Campus' %>">
                </div>
              </div>
            </div>
            
            <div class="row mb-3">
              <div class="col-md-6">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="isActive" name="isActive" <%= bus.isActive ? 'checked' : '' %>>
                  <label class="form-check-label" for="isActive">Bus is active and ready for service</label>
                </div>
              </div>
              <div class="col-md-6">
                <a href="#changePin" class="btn btn-outline-warning" data-bs-toggle="collapse">
                  <i class="fas fa-key me-1"></i> Change PIN
                </a>
              </div>
            </div>
            
            <div class="collapse mb-4" id="changePin">
              <div class="card card-body border-warning">
                <h6 class="mb-3"><i class="fas fa-lock me-2"></i> Change Driver PIN</h6>
                <div class="row">
                  <div class="col-md-4 mb-3">
                    <label for="currentPin" class="form-label">Current PIN</label>
                    <input type="password" class="form-control" id="currentPin" name="currentPin" placeholder="Current PIN">
                  </div>
                  <div class="col-md-4 mb-3">
                    <label for="newPin" class="form-label">New PIN</label>
                    <input type="password" class="form-control" id="newPin" name="newPin" placeholder="New PIN">
                  </div>
                  <div class="col-md-4 mb-3">
                    <label for="confirmNewPin" class="form-label">Confirm New PIN</label>
                    <input type="password" class="form-control" id="confirmNewPin" name="confirmNewPin" placeholder="Confirm New PIN">
                  </div>
                </div>
                <p class="text-muted small">Leave blank if you don't want to change the PIN.</p>
              </div>
            </div>
            
            <hr class="my-4">
            
            <div class="row mb-3">
              <div class="col-md-6 mb-3 mb-md-0">
                <h6 class="mb-3"><i class="fas fa-tools me-2 text-secondary"></i> Maintenance Information</h6>
                <div class="input-group mb-3">
                  <span class="input-group-text">Last Service</span>
                  <input type="date" class="form-control" id="lastMaintenanceDate" name="lastMaintenanceDate" value="<%= bus.lastMaintenanceDate ? new Date(bus.lastMaintenanceDate).toISOString().split('T')[0] : '' %>">
                </div>
                <div class="input-group mb-3">
                  <span class="input-group-text">Next Service</span>
                  <input type="date" class="form-control" id="nextMaintenanceDate" name="nextMaintenanceDate" value="<%= bus.nextMaintenanceDate ? new Date(bus.nextMaintenanceDate).toISOString().split('T')[0] : '' %>">
                </div>
                <div class="input-group mb-3">
                  <span class="input-group-text">Fuel Status</span>
                  <input type="range" class="form-range form-control" id="fuelStatus" name="fuelStatus" min="0" max="100" value="<%= bus.fuelStatus || 70 %>" style="height: auto; padding: 10px;">
                  <span class="input-group-text" id="fuelStatusValue"><%= bus.fuelStatus || 70 %>%</span>
                </div>
                <div class="input-group">
                  <span class="input-group-text">Engine Health</span>
                  <input type="range" class="form-range form-control" id="engineHealth" name="engineHealth" min="0" max="100" value="<%= bus.engineHealth || 85 %>" style="height: auto; padding: 10px;">
                  <span class="input-group-text" id="engineHealthValue"><%= bus.engineHealth || 85 %>%</span>
                </div>
              </div>
              <div class="col-md-6">
                <h6 class="mb-3"><i class="fas fa-sticky-note me-2 text-secondary"></i> Notes</h6>
                <textarea class="form-control" id="notes" name="notes" rows="8" placeholder="Additional notes about this bus"><%= bus.notes || '' %></textarea>
              </div>
            </div>
            
            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
              <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                <i class="fas fa-trash me-1"></i> Delete Bus
              </button>
              <button type="reset" class="btn btn-outline-secondary">
                <i class="fas fa-undo me-1"></i> Reset
              </button>
              <button type="submit" class="btn btn-warning">
                <i class="fas fa-save me-1"></i> Update Bus
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteModalLabel">
          <i class="fas fa-exclamation-triangle me-2"></i> Confirm Delete
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete bus <strong><%= bus.busId %></strong>?</p>
        <p class="text-danger"><i class="fas fa-exclamation-circle me-1"></i> This action cannot be undone and will permanently remove all data associated with this bus.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <form action="/management/buses/delete/<%= bus._id %>?_method=DELETE" method="POST">
          <button type="submit" class="btn btn-danger">
            <i class="fas fa-trash me-1"></i> Delete Permanently
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // PIN validation
    const newPinInput = document.getElementById('newPin');
    const confirmNewPinInput = document.getElementById('confirmNewPin');
    
    if (newPinInput && confirmNewPinInput) {
      confirmNewPinInput.addEventListener('input', function() {
        if (newPinInput.value !== confirmNewPinInput.value) {
          confirmNewPinInput.setCustomValidity("PINs don't match");
        } else {
          confirmNewPinInput.setCustomValidity('');
        }
      });
      
      newPinInput.addEventListener('input', function() {
        if (newPinInput.value && confirmNewPinInput.value && newPinInput.value !== confirmNewPinInput.value) {
          confirmNewPinInput.setCustomValidity("PINs don't match");
        } else {
          confirmNewPinInput.setCustomValidity('');
        }
      });
    }
    
    // Range inputs
    const fuelStatus = document.getElementById('fuelStatus');
    const fuelStatusValue = document.getElementById('fuelStatusValue');
    const engineHealth = document.getElementById('engineHealth');
    const engineHealthValue = document.getElementById('engineHealthValue');
    
    if (fuelStatus && fuelStatusValue) {
      fuelStatus.addEventListener('input', function() {
        fuelStatusValue.textContent = this.value + '%';
      });
    }
    
    if (engineHealth && engineHealthValue) {
      engineHealth.addEventListener('input', function() {
        engineHealthValue.textContent = this.value + '%';
      });
    }
  });
</script> 